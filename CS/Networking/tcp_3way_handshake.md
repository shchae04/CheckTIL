# TCP 3-Way Handshake

## 1. TCP 개요

TCP(Transmission Control Protocol)는 인터넷 프로토콜 스위트(Internet Protocol Suite)의 핵심 프로토콜 중 하나로, 네트워크 통신에서 신뢰성 있는 데이터 전송을 보장합니다. TCP는 연결 지향적(connection-oriented) 프로토콜로, 데이터를 교환하기 전에 먼저 연결을 설정해야 합니다. 이 연결 설정 과정이 바로 '3-Way Handshake'입니다.

## 2. TCP 3-Way Handshake란?

TCP 3-Way Handshake는 TCP 연결을 설정하기 위해 클라이언트와 서버 간에 세 단계의 패킷 교환 과정을 거치는 방식입니다. 이 과정을 통해 양쪽 모두 데이터를 주고받을 준비가 되었는지 확인하고, 초기 시퀀스 번호(Initial Sequence Number, ISN)를 교환합니다.

## 3. 3-Way Handshake 과정

```
클라이언트                                           서버
    |                                                |
    |------------------ SYN (seq=x) --------------->|
    |                                                |
    |<-------- SYN-ACK (seq=y, ack=x+1) ------------|
    |                                                |
    |----------------- ACK (ack=y+1) -------------->|
    |                                                |
    |                연결 설정 완료                   |
    |                                                |
```

### 단계 1: SYN (Synchronize)
- 클라이언트는 서버에 연결을 요청하는 SYN 패킷을 보냅니다.
- 이 패킷에는 클라이언트의 초기 시퀀스 번호(ISN)인 'x'가 포함됩니다.
- TCP 헤더의 SYN 플래그가 1로 설정됩니다.

### 단계 2: SYN-ACK (Synchronize-Acknowledgment)
- 서버는 클라이언트의 SYN 패킷을 받고, SYN-ACK 패킷으로 응답합니다.
- 이 패킷에는 서버의 초기 시퀀스 번호(ISN)인 'y'와 클라이언트의 시퀀스 번호에 1을 더한 값(x+1)이 ACK 번호로 포함됩니다.
- TCP 헤더의 SYN과 ACK 플래그가 모두 1로 설정됩니다.

### 단계 3: ACK (Acknowledgment)
- 클라이언트는 서버의 SYN-ACK 패킷을 받고, ACK 패킷으로 응답합니다.
- 이 패킷에는 서버의 시퀀스 번호에 1을 더한 값(y+1)이 ACK 번호로 포함됩니다.
- TCP 헤더의 ACK 플래그가 1로 설정됩니다.
- 이 단계가 완료되면 TCP 연결이 설정되고, 데이터 전송이 시작될 수 있습니다.

## 4. 시퀀스 번호와 확인 응답 번호

### 시퀀스 번호(Sequence Number)
- 각 TCP 세그먼트의 데이터 바이트 스트림에서의 위치를 나타냅니다.
- 초기 시퀀스 번호(ISN)는 무작위로 선택되어 보안을 강화합니다.
- 시퀀스 번호를 통해 패킷의 순서를 보장하고 중복을 방지합니다.

### 확인 응답 번호(Acknowledgment Number)
- 다음에 받기를 기대하는 시퀀스 번호를 나타냅니다.
- 이전에 받은 데이터의 마지막 바이트 시퀀스 번호 + 1의 값입니다.
- 이를 통해 상대방이 어디까지 데이터를 성공적으로 받았는지 알 수 있습니다.

## 5. 3-Way Handshake의 목적

1. **연결 동기화**: 양쪽 모두 통신할 준비가 되었는지 확인합니다.
2. **시퀀스 번호 동기화**: 데이터 전송 시 패킷의 순서를 보장하기 위해 초기 시퀀스 번호를 교환합니다.
3. **연결 매개변수 협상**: 윈도우 크기, 최대 세그먼트 크기(MSS) 등의 TCP 매개변수를 협상합니다.
4. **보안 강화**: 무작위 시퀀스 번호를 사용하여 TCP 스푸핑 공격을 어렵게 만듭니다.

## 6. 잠재적 문제와 해결책

### SYN 플러딩 공격(SYN Flooding Attack)
- 공격자가 대량의 SYN 패킷을 보내고 ACK를 보내지 않아 서버의 리소스를 고갈시키는 공격입니다.
- **해결책**: SYN 쿠키, 타임아웃 조정, 방화벽 설정 등으로 방어할 수 있습니다.

### 타임아웃 문제
- 네트워크 지연이나 패킷 손실로 인해 핸드셰이크 과정이 완료되지 않을 수 있습니다.
- **해결책**: 재전송 메커니즘과 타임아웃 설정으로 해결합니다.

## 7. 실제 사용 사례

### 웹 브라우징
- 웹 브라우저가 웹 서버에 HTTP 요청을 보내기 전에 TCP 연결을 설정합니다.
- 예: 사용자가 웹사이트를 방문할 때마다 3-Way Handshake가 발생합니다.

### 이메일 전송
- 이메일 클라이언트가 SMTP 서버와 통신하기 전에 TCP 연결을 설정합니다.

### 파일 전송
- FTP와 같은 파일 전송 프로토콜은 데이터 전송을 위해 TCP 연결을 사용합니다.

## 8. 결론

TCP 3-Way Handshake는 인터넷 통신의 기본이 되는 중요한 프로세스입니다. 이 과정을 통해 TCP는 신뢰성 있는 데이터 전송을 보장하고, 연결 지향적인 특성을 구현합니다. 3-Way Handshake의 이해는 네트워크 문제 해결, 보안 강화, 그리고 효율적인 네트워크 애플리케이션 개발에 필수적입니다.

## 9. 참고 자료

- RFC 793: Transmission Control Protocol
- Computer Networks: A Systems Approach (Larry L. Peterson & Bruce S. Davie)
- TCP/IP Illustrated, Volume 1: The Protocols (W. Richard Stevens)