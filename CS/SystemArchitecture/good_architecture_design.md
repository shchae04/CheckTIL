# 좋은 아키텍처 설계란?

## 1. 한 줄 요약
- 좋은 아키텍처는 “비즈니스 가치를 빠르고 안전하게 전달하도록” 시스템의 경계, 의존성, 데이터 소유, 운영 방식을 의도적으로 설계하고, 변화에 강하며(진화 가능성) 품질 속성(성능/확장성/가용성/보안/유지보수성 등)을 균형 있게 달성한다.

---

## 2. 정의와 관점
- 아키텍처는 시스템의 중요한 구조적 결정들의 집합: 경계(Boundary), 의존성 방향(Dependency Direction), 데이터 소유권(Data Ownership), 통신 스타일, 배포/운영 모델 등.
- “무엇을 선택했는가”보다 “왜 그렇게 선택했는가(Trade-off)”가 핵심. 비기능 요구사항(NFR) 충족을 목표로 한다.
- 조직 구조(Conway’s Law), 팀 역량, 비용/제약을 포함한 현실 세계의 변수까지 고려하는 실용적 의사결정의 결과물.

---

## 3. 품질 속성(Quality Attributes)
- 확장성(Scalability), 성능(Performance), 가용성/신뢰성(Availability/Reliability), 회복성(Resilience), 보안(Security), 일관성/데이터 무결성(Consistency), 유지보수성/가독성(Maintainability), 테스트 용이성(Testability), 관측 가능성(Observability), 비용 효율(Cost Efficiency), 운영 용이성(Operability).
- 품질 속성은 상충한다. 목표치를 수치화(SLO, RTO/RPO, p95/p99 지연 등)하고 트레이드오프를 명시한다.

---

## 4. 핵심 원칙(Principles)
- 경계와 응집/결합: 높은 응집, 낮은 결합. 명확한 Bounded Context(DDD)와 데이터 소유.
- 의존성 방향: 도메인 중심(클린/헥사고날). 내부 규칙 → 외부 어댑터로 나가는 방향. DIP/포트-어댑터.
- 단순함과 적시성: KISS, YAGNI. 과설계를 피하고 검증된 필요에 맞춰 확장.
- 명시적 계약: API/스키마 버저닝, 호환성(Backward/Forward), 스키마 마이그레이션 전략.
- 실패 전제 설계: 타임아웃, 재시도+지수 백오프, 서킷브레이커, 벌크헤드, 백프레셔.
- 상태 관리: 불변성 선호, 멱등성(Idempotency), 중복 방지 키, 샤딩 키 설계.
- 데이터 일관성: 트랜잭션 경계 명확화, 사가/Outbox/이벤트 소싱 등으로 최종 일관성 관리.
- 관측 가능성: 구조화 로그, 메트릭, 트레이싱 표준화. 레이턴시 버짓/에러 버짓 운영.
- 자동화: IaC, CI/CD, 블루-그린/카나리, 피처 플래그로 리스크 축소.
- 보안 기본값: 제로트러스트, 최소 권한, 비밀관리, 암호화, 입력 검증.

---

## 5. 설계 접근법(Workflow)
1) 요구사항 정제: 유스케이스, 볼륨/패턴(트래픽/데이터), NFR(SLO, RTO/RPO), 규제/컴플라이언스.
2) 시나리오 기반 평가: ATAM/유틸리티 트리로 품질 속성 시나리오를 도출·우선순위화.
3) 아키패턴 선택: 모놀리식 우선 vs 마이크로서비스, 동기 REST vs 이벤트 기반, CQRS/ES 필요성.
4) 데이터/일관성: 파티셔닝, 캐시 전략, CDC/Outbox, 스키마/버전 전략.
5) 확장 전략: Stateless/수평 확장, 워크큐/백프레셔, 파티션 설계, 읽기/쓰기 분리.
6) 배포/운영: CI/CD, 카나리/블루-그린, 롤백·롤포워드, 피처 플래그.
7) 비용/리스크: 용량 산정, SRE 관점 운영성, 비용 가드레일.

---

## 6. 의사결정 기록(ADR)
- 포맷: Context → Decision → Status → Consequences → Alternatives.
- 예: "동기 통신 대신 이벤트 브로커 사용" 결정의 이유(결합도, 복원력), 비용(지연, 운영 복잡성), 대안(동기+큐 혼합) 등.

---

## 7. 흔한 안티패턴
- 빅 볼 오브 머드(Big Ball of Mud): 경계 부재, 공용 모델 난립.
- 분산 모놀리스: 서비스는 나뉘었지만 강한 동기 결합/공유 DB.
- 조기 마이크로서비스/과설계: 팀/도메인 성숙도 미달 상태에서 과도한 분할.
- 공용 데이터베이스 공유: 스키마 결합과 배포 독립성 상실.
- 요청 팬아웃/채티 통신: 트랜잭션 지연/불안정. 집계/캐시/비동기로 완화.
- 타임아웃/재시도/백프레셔 부재: 장애 전파/폭발.
- 황금 망치(Golden Hammer): 단일 기술로 모든 문제 해결 시도.
- 조기 최적화: 측정 없는 튜닝. 관측 기반 접근 필요.

---

## 8. 실무 체크리스트(Quick Checklist)
- 요구/제약: 핵심 유스케이스, NFR(SLO, RTO/RPO), 트래픽 프로파일 명시.
- 경계/소유: Bounded Context, 데이터 소유, API 계약/버전.
- 통신/흐름: 동기/비동기 기준, 큐/브로커 사용, 백프레셔.
- 일관성: 트랜잭션 경계, 사가/Outbox, 멱등/중복처리.
- 확장/성능: 캐시 전략, 파티셔닝, 읽기/쓰기 분리, 병렬화.
- 실패/복원: 타임아웃/재시도/서킷, 장애 격리, 카오스 테스팅 계획.
- 관측/운영: 로그/메트릭/트레이싱, 알림, 런북, 에러 버짓.
- 보안/컴플라이언스: 인증/인가, 데이터 보호, 비밀관리, 감사.
- 배포/릴리즈: CI/CD, 카나리/블루-그린, 롤백 전략, 피처 플래그.
- 비용: 용량/코스트 예산, 비용 모니터링, 효율화 가드레일.

---

## 9. 인터뷰 포인트
- 아키텍처 vs 설계 차이, 트레이드오프 설명 능력.
- 모놀리식 우선 접근의 근거와 마이크로서비스로의 진화 경로.
- 일관성 모델 선택 사례(CAP/PACELC)와 사가/Outbox 활용.
- 장애 복원/관측 가능성 설계 요소.
- ADR 작성과 변경 관리.

---

## 10. 관련 문서
- 개요: ./system_architecture.md
- 동시성과 병렬성: ../Concurrency/concurrency_vs_parallelism.md
- 스프링 요청 흐름: ../../Interview/spring_request_flow.md
- RESTful API 기본: ../../Interview/restful_api.md
- 캐싱 전략: ../../Interview/caching_strategies.md
- (참고) DB 동시성 제어: ../Database/database_concurrency_control.md
