# AWS에 웹사이트 배포 및 도메인 연결 과정

오늘은 웹사이트를 AWS 인스턴스에 배포하고, 도메인을 연결하고, DNS를 전파하고, ACM(AWS Certificate Manager)에 SSL 인증서를 등록하는 전체 과정에 대해 정리해보겠습니다.

## 1. AWS 인스턴스 설정 및 웹사이트 배포

### 1.1 EC2 인스턴스 생성

1. **AWS 콘솔에 로그인**하고 EC2 서비스로 이동합니다.
2. **인스턴스 시작** 버튼을 클릭합니다.
3. **AMI(Amazon Machine Image) 선택**: 웹 서버에 적합한 AMI를 선택합니다. 일반적으로 Amazon Linux 2, Ubuntu 등이 많이 사용됩니다.
4. **인스턴스 유형 선택**: 웹사이트의 트래픽과 리소스 요구사항에 따라 적절한 인스턴스 유형을 선택합니다.
5. **인스턴스 세부 정보 구성**: 기본 설정을 유지하거나 필요에 따라 조정합니다.
6. **스토리지 추가**: 웹사이트 파일과 데이터베이스에 필요한 충분한 스토리지를 할당합니다.
7. **태그 추가**: 인스턴스를 식별하기 위한 태그를 추가합니다.
8. **보안 그룹 구성**: 웹 트래픽을 허용하기 위해 다음 포트를 열어줍니다:
   - HTTP (80)
   - HTTPS (443)
   - SSH (22) - 관리 목적으로, 특정 IP에서만 접근 가능하도록 제한하는 것이 좋습니다.
9. **키 페어 생성 또는 선택**: SSH 접속에 사용할 키 페어를 생성하거나 기존 키를 선택합니다.
10. **인스턴스 시작** 버튼을 클릭하여 인스턴스를 생성합니다.

### 1.2 웹 서버 설치 및 구성

1. **SSH를 통해 인스턴스에 연결**:
   ```bash
   ssh -i your-key.pem ec2-user@your-instance-public-ip
   ```

2. **시스템 업데이트**:
   ```bash
   sudo yum update -y  # Amazon Linux의 경우
   # 또는
   sudo apt update && sudo apt upgrade -y  # Ubuntu의 경우
   ```

3. **웹 서버 설치** (예: Nginx):
   ```bash
   sudo yum install nginx -y  # Amazon Linux의 경우
   # 또는
   sudo apt install nginx -y  # Ubuntu의 경우
   ```

4. **웹 서버 시작 및 자동 시작 설정**:
   ```bash
   sudo systemctl start nginx
   sudo systemctl enable nginx
   ```

### 1.3 웹사이트 파일 배포

1. **웹사이트 파일 전송** (로컬 컴퓨터에서):
   ```bash
   scp -i your-key.pem -r your-website-folder ec2-user@your-instance-public-ip:/tmp/
   ```

2. **웹 서버 디렉토리로 파일 이동** (EC2 인스턴스에서):
   ```bash
   sudo mv /tmp/your-website-folder/* /var/www/html/
   ```

3. **파일 권한 설정**:
   ```bash
   sudo chown -R nginx:nginx /var/www/html/
   sudo chmod -R 755 /var/www/html/
   ```

4. **웹 서버 설정 파일 수정**:
   ```bash
   sudo nano /etc/nginx/nginx.conf
   # 또는
   sudo nano /etc/nginx/sites-available/default
   ```

5. **웹 서버 재시작**:
   ```bash
   sudo systemctl restart nginx
   ```

## 2. 도메인 연결 및 DNS 설정

### 2.1 도메인 등록

1. **도메인 등록 서비스 선택**: AWS Route 53, GoDaddy, Namecheap 등의 서비스에서 도메인을 등록합니다.
2. **도메인 이름 선택 및 구매**: 원하는 도메인 이름을 검색하고 사용 가능한 경우 구매합니다.
3. **도메인 등록 정보 입력**: 소유자 정보, 연락처 등을 입력합니다.

### 2.2 Route 53에서 호스팅 영역 생성 (AWS Route 53 사용 시)

1. **AWS 콘솔에서 Route 53 서비스로 이동**합니다.
2. **호스팅 영역 생성** 버튼을 클릭합니다.
3. **도메인 이름 입력**: 등록한 도메인 이름을 입력합니다.
4. **호스팅 영역 유형 선택**: 공개 호스팅 영역을 선택합니다.
5. **생성** 버튼을 클릭합니다.

### 2.3 DNS 레코드 설정

1. **호스팅 영역 세부 정보 페이지에서 레코드 생성** 버튼을 클릭합니다.
2. **레코드 유형 선택**: A 레코드를 선택합니다.
3. **이름 필드**: 루트 도메인(@) 또는 서브도메인(www)을 입력합니다.
4. **값 필드**: EC2 인스턴스의 퍼블릭 IP 주소를 입력합니다.
5. **TTL 설정**: 기본값(300초)을 유지하거나 필요에 따라 조정합니다.
6. **레코드 생성** 버튼을 클릭합니다.

### 2.4 도메인 네임서버 설정 (외부 도메인 등록 서비스 사용 시)

1. **Route 53 호스팅 영역에서 NS(네임서버) 레코드 정보를 확인**합니다.
2. **도메인 등록 서비스의 관리 페이지로 이동**합니다.
3. **네임서버 설정 메뉴로 이동**합니다.
4. **Route 53의 네임서버로 변경**합니다 (일반적으로 ns-XXXX.awsdns-XX.com 형식).
5. **변경사항 저장**합니다.

### 2.5 DNS 전파 확인

1. **DNS 전파 확인 도구 사용**: [whatsmydns.net](https://www.whatsmydns.net/) 같은 도구를 사용하여 DNS 전파 상태를 확인합니다.
2. **도메인 이름 입력** 후 검색합니다.
3. **전 세계 여러 위치에서 DNS 확인 결과를 확인**합니다.
4. **DNS 전파는 일반적으로 24-48시간이 소요**될 수 있으나, 대부분의 경우 몇 시간 내에 완료됩니다.

## 3. ACM(AWS Certificate Manager)에 SSL 인증서 등록

### 3.1 SSL 인증서 요청

1. **AWS 콘솔에서 ACM(Certificate Manager) 서비스로 이동**합니다.
2. **인증서 요청** 버튼을 클릭합니다.
3. **퍼블릭 인증서 요청** 옵션을 선택합니다.
4. **도메인 이름 입력**: 
   - 기본 도메인(example.com)과 
   - 와일드카드 도메인(*.example.com)을 함께 입력하면 모든 서브도메인을 커버할 수 있습니다.
5. **검증 방법 선택**: 
   - **DNS 검증**: 도메인 소유권을 DNS 레코드로 증명합니다 (권장).
   - **이메일 검증**: 도메인 관리자 이메일로 확인 링크를 받습니다.
6. **요청** 버튼을 클릭합니다.

### 3.2 도메인 소유권 검증

#### DNS 검증 방법 (권장)

1. **인증서 세부 정보 페이지에서 도메인 옆의 "Route 53에서 레코드 생성" 버튼을 클릭**합니다.
2. **레코드 생성** 버튼을 클릭하여 검증용 CNAME 레코드를 자동으로 생성합니다.
3. **검증 상태가 "성공"으로 변경될 때까지 기다립니다** (일반적으로 몇 분에서 몇 시간 소요).

#### 이메일 검증 방법

1. **도메인 관리자 이메일(admin@example.com, webmaster@example.com 등)로 전송된 확인 이메일을 확인**합니다.
2. **이메일의 확인 링크를 클릭**하여 도메인 소유권을 확인합니다.

### 3.3 로드 밸런서 설정 (선택 사항)

SSL 인증서를 EC2 인스턴스에 직접 설치하는 대신, AWS의 로드 밸런서를 사용하면 SSL 종료(SSL Termination)를 더 효율적으로 관리할 수 있습니다.

1. **AWS 콘솔에서 EC2 서비스로 이동**한 후 **로드 밸런서** 메뉴를 선택합니다.
2. **로드 밸런서 생성** 버튼을 클릭합니다.
3. **Application Load Balancer** 유형을 선택합니다.
4. **이름 및 스키마 설정**: 
   - 이름을 입력합니다.
   - 인터넷 연결 옵션을 선택합니다.
5. **리스너 구성**: 
   - HTTP(80) 및 HTTPS(443) 리스너를 추가합니다.
   - HTTPS 리스너에 대해 이전에 발급받은 ACM 인증서를 선택합니다.
6. **가용 영역 선택**: 최소 두 개의 가용 영역을 선택합니다.
7. **보안 그룹 구성**: HTTP 및 HTTPS 트래픽을 허용하는 보안 그룹을 선택합니다.
8. **라우팅 구성**: 
   - 새 대상 그룹을 생성합니다.
   - 대상 유형으로 "인스턴스"를 선택합니다.
   - 상태 확인 경로를 설정합니다 (예: /index.html).
9. **대상 등록**: EC2 인스턴스를 대상 그룹에 등록합니다.
10. **생성** 버튼을 클릭합니다.

### 3.4 DNS 레코드 업데이트 (로드 밸런서 사용 시)

1. **Route 53 호스팅 영역으로 이동**합니다.
2. **기존 A 레코드를 선택**하고 **레코드 편집** 버튼을 클릭합니다.
3. **라우팅 정책**으로 "단순 라우팅"을 선택합니다.
4. **레코드 유형**을 A에서 **별칭(A)**으로 변경합니다.
5. **트래픽 라우팅 대상**으로 "Application/Classic Load Balancer에 대한 별칭"을 선택합니다.
6. **리전 선택** 후 생성한 로드 밸런서를 선택합니다.
7. **저장** 버튼을 클릭합니다.

### 3.5 HTTP에서 HTTPS로 리디렉션 설정

#### Nginx 웹 서버에서 설정 (로드 밸런서 없이 직접 SSL 사용 시)

1. **Nginx 설정 파일 편집**:
   ```bash
   sudo nano /etc/nginx/sites-available/default
   ```

2. **다음과 같이 리디렉션 설정 추가**:
   ```nginx
   server {
       listen 80;
       server_name example.com www.example.com;
       return 301 https://$host$request_uri;
   }

   server {
       listen 443 ssl;
       server_name example.com www.example.com;
       
       ssl_certificate /path/to/certificate.pem;
       ssl_certificate_key /path/to/private.key;
       
       # SSL 설정
       ssl_protocols TLSv1.2 TLSv1.3;
       ssl_prefer_server_ciphers on;
       ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384';
       
       # 웹사이트 파일 위치
       root /var/www/html;
       index index.html index.htm;
       
       location / {
           try_files $uri $uri/ =404;
       }
   }
   ```

3. **Nginx 재시작**:
   ```bash
   sudo systemctl restart nginx
   ```

#### 로드 밸런서에서 설정 (로드 밸런서 사용 시)

1. **EC2 콘솔에서 로드 밸런서로 이동**합니다.
2. **리스너 탭을 선택**합니다.
3. **HTTP(80) 리스너를 편집**합니다.
4. **기본 작업**을 "리디렉션"으로 변경합니다.
5. **리디렉션 대상**을 HTTPS(443)으로 설정합니다.
6. **상태 코드**를 301(영구 이동)으로 설정합니다.
7. **저장** 버튼을 클릭합니다.

## 4. 최종 확인 및 테스트

### 4.1 웹사이트 접속 테스트

1. **브라우저에서 도메인 이름으로 접속**합니다 (https://example.com).
2. **HTTPS 연결이 안전하게 설정**되었는지 확인합니다 (브라우저의 자물쇠 아이콘).
3. **웹사이트가 정상적으로 로드**되는지 확인합니다.

### 4.2 SSL 인증서 확인

1. **브라우저에서 자물쇠 아이콘을 클릭**합니다.
2. **인증서 정보를 확인**합니다:
   - 발급자: Amazon
   - 유효 기간: 13개월 (ACM에서 자동 갱신)
   - 도메인 이름: 요청한 도메인과 일치하는지 확인

### 4.3 모바일 기기에서 테스트

1. **스마트폰이나 태블릿에서 웹사이트에 접속**합니다.
2. **반응형 디자인이 제대로 작동**하는지 확인합니다.
3. **페이지 로딩 속도를 확인**합니다.

## 5. 유지 관리 및 모니터링

### 5.1 CloudWatch 알람 설정

1. **AWS 콘솔에서 CloudWatch 서비스로 이동**합니다.
2. **알람 생성** 버튼을 클릭합니다.
3. **EC2 인스턴스의 CPU 사용률, 메모리 사용률 등에 대한 알람을 설정**합니다.
4. **임계값을 설정**하고 알림을 받을 SNS 주제를 구성합니다.

### 5.2 자동 백업 설정

1. **EC2 인스턴스의 EBS 볼륨에 대한 스냅샷 일정을 설정**합니다.
2. **AWS Backup 서비스를 사용**하여 정기적인 백업 계획을 수립합니다.

### 5.3 보안 업데이트

1. **정기적으로 EC2 인스턴스에 접속**하여 시스템 업데이트를 수행합니다:
   ```bash
   sudo yum update -y  # Amazon Linux
   # 또는
   sudo apt update && sudo apt upgrade -y  # Ubuntu
   ```

2. **웹 서버 소프트웨어를 최신 버전으로 유지**합니다.

## 결론

AWS에 웹사이트를 배포하고 도메인을 연결하는 과정은 여러 단계로 이루어져 있지만, 체계적으로 접근하면 안전하고 효율적인 웹 환경을 구축할 수 있습니다. EC2 인스턴스 설정부터 시작하여 도메인 연결, DNS 설정, SSL 인증서 등록까지의 전체 과정을 통해 사용자에게 안전하고 신뢰할 수 있는 웹사이트를 제공할 수 있습니다.

특히 ACM을 통한 SSL 인증서 관리는 인증서의 자동 갱신 기능을 제공하여 만료로 인한 서비스 중단 위험을 크게 줄여줍니다. 또한 로드 밸런서를 활용하면 트래픽 분산과 SSL 종료를 효율적으로 관리할 수 있어, 웹사이트의 성능과 가용성을 향상시킬 수 있습니다.